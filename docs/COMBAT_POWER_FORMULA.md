# SUGO.gg 전투력 계산 시스템 (ECP v2.1)

## 개요

AION2 캐릭터의 PVE/PVP 전투력을 계산하는 시스템입니다.

---

## 기본 공식

```
전투력 = (공격력계수 × 파워멀티플라이어 × 전투효율 × 정확도보정 × 다단히트계수) × 1000 × 캘리브레이션
```

**캘리브레이션 상수**: `12.03` (도룡뇽 캐릭터 기준 16,000점 목표)

---

## 각 계수 상세

### 1. 공격력 계수 (Attack Coefficient)

```
공격력계수 = 최종공격력 / 1000
최종공격력 = (기본공격력 × (1 + 공격력증가%/100)) + PVE공격력 + 보스공격력
```

| 입력 스탯 | 설명 |
|----------|------|
| 기본공격력 | 캐릭터 기본 공격력 |
| 공격력증가% | 장비/칭호 등에서 오는 % 증가 |
| PVE공격력 | PVE 전용 추가 공격력 |
| 보스공격력 | 보스 전용 추가 공격력 |

---

### 2. 파워 멀티플라이어 (Power Multiplier)

```
파워멀티플라이어 = 1 + 치명타계수 + 피해증폭계수 + 치명타피해증폭계수 + 강타계수
```

| 구성 요소 | 계산식 |
|----------|--------|
| 치명타계수 | max(0, (치명타 - 500) / 1000) |
| 피해증폭계수 | (피해증폭% + PVE피해증폭% + 보스피해증폭%) / 100 |
| 치명타피해증폭계수 | 치명타피해증폭% / 100 |
| 강타계수 | 강타% / 100 |

---

### 3. 전투 효율 (Combat Efficiency)

```
전투효율 = 1 + min(1.0, 전투속도% / 100)
```

- 전투속도 최대 100%까지만 적용 (하드캡)
- 예: 전투속도 50% → 전투효율 1.5

---

### 4. 정확도 보정 (Accuracy Gate)

```
if (명중 >= 2500):
    정확도보정 = 1.0
else:
    정확도보정 = max(0, 1 - (2500 - 명중) / 2500)
```

- 명중 2500 이상: 페널티 없음
- 명중 2500 미만: 선형 페널티 적용

---

### 5. 다단히트 계수 (Multi-Hit)

```
실제확률 = min(100, 19 + 다단히트%)
```

| 실제확률 | 다단히트계수 |
|---------|------------|
| ≥100% | 1.206 (+20.6%) |
| 80~99% | 1.078 ~ 1.206 (선형 보간) |
| 50~79% | 1.010 ~ 1.078 (선형 보간) |
| <50% | 1.010 (+1.0%) |

- 숨겨진 기본 확률 19% 존재
- 최대 4회 판정, 실패 시 중단

---

## 등급 시스템

| 등급 | 색상 | 점수 범위 |
|------|------|----------|
| Diamond (D) | #B9F2FF | 50,000+ |
| Ruby (R) | #E0115F | 35,000 ~ 50,000 |
| Sapphire (Sa) | #0F52BA | 25,000 ~ 35,000 |
| Emerald (E) | #50C878 | 18,000 ~ 25,000 |
| Platinum (P) | #E5E4E2 | 13,000 ~ 18,000 |
| Gold (G) | #FFD700 | 9,000 ~ 13,000 |
| Silver (Si) | #C0C0C0 | 5,000 ~ 9,000 |
| Bronze (B) | #CD7F32 | 0 ~ 5,000 |

각 등급은 5단계로 세분화 (예: G1, G2, G3, G4, G5)

---

## PVP 전투력 계산

PVE와 동일한 공식이지만 다음 스탯 사용:

| PVE | PVP |
|-----|-----|
| PVE공격력 + 보스공격력 | PVP공격력 |
| PVE피해증폭 + 보스피해증폭 | PVP피해증폭 |
| 공격력증가% | 공격력증가% + PVP공격력증가% |

---

## 계산 예시

### 예시 입력 스탯
```
공격력: 3,100
공격력증가: 15%
PVE공격력: 200
보스공격력: 150
치명타: 1,200
피해증폭: 10%
PVE피해증폭: 8%
보스피해증폭: 5%
치명타피해증폭: 25%
강타: 300 (30%)
전투속도: 50%
명중: 3,800
다단히트: 60%
```

### 계산 과정
```
1. 최종공격력 = 3100 × 1.15 + 200 + 150 = 3,915
2. 공격력계수 = 3915 / 1000 = 3.915

3. 치명타계수 = (1200 - 500) / 1000 = 0.7
4. 피해증폭계수 = (10 + 8 + 5) / 100 = 0.23
5. 치명타피해증폭계수 = 25 / 100 = 0.25
6. 강타계수 = 30 / 100 = 0.30 (300 → 30%로 해석)
7. 파워멀티플라이어 = 1 + 0.7 + 0.23 + 0.25 + 0.30 = 2.48

8. 전투효율 = 1 + 0.5 = 1.5
9. 정확도보정 = 1.0 (3800 > 2500)
10. 다단히트계수 = 1.078 (실제확률 79%)

11. 기본점수 = 3.915 × 2.48 × 1.5 × 1.0 × 1.078 = 15.71
12. 최종전투력 = 15.71 × 1000 × 12.03 = 188,991
```

---

## 스탯 추출 우선순위

1. 집계된 스탯 (장비 + 칭호 + 데바니온)
2. 기본 스탯 (API statList)
3. 폴백 값 (데이터 없을 시)

### 폴백 기본값
```
공격력: 3,100
명중: 3,800
치명타: 1,200
강타: 300
```

---

## 참고 파일

- `frontend/src/lib/combatPower.ts` - 전투력 계산 메인 로직
- `frontend/src/lib/statsAggregator.ts` - 스탯 집계 로직

---

## 캐릭터별 전투력 테스트 결과

### 테스트 환경
- 서버: 마족 지켈
- 측정일: 2026-01-19
- 버전: ECP v2.1

### 테스트 캐릭터

| 캐릭터 | 클래스 | 아이템레벨 | PVE 전투력 | 등급 |
|--------|--------|-----------|-----------|------|
| 도룡뇽 | 살성 | 2,823 | 11,990 | G3 |
| 죄수 | 수호성 | 3,093 | 24,530 | Sa5 |
| 대화 | - | - | 42,171 | R4 |
| 혜지성 | 치유성 | 3,120 | 37,454 | R1 |
| 차은욱 | 검성 | 3,170 | 38,431 | R2 |
| 아담 | 검성 | 3,076 | 35,216 | R5 |
| 하와 | 치유성 | 3,020 | 21,890 | E4 |

### 캐릭터 상세 정보

#### 도룡뇽 (기준 캐릭터)
- **클래스**: 살성 (Assassin)
- **길드**: 봄
- **아이템레벨**: 2,823
- **전투력**: 11,990 (G3)
- **특징**: 캘리브레이션 기준 캐릭터

#### 죄수
- **클래스**: 수호성 (Guardian)
- **아이템레벨**: 3,093
- **전투력**: 24,530 (Sa5)

#### 대화
- **아이템레벨**: -
- **전투력**: 42,171 (R4)

#### 혜지성
- **클래스**: 치유성 (Cleric)
- **아이템레벨**: 3,120
- **전투력**: 37,454 (R1)

#### 차은욱
- **클래스**: 검성 (Gladiator)
- **아이템레벨**: 3,170
- **전투력**: 38,431 (R2)

#### 아담
- **클래스**: 검성 (Gladiator)
- **아이템레벨**: 3,076
- **전투력**: 35,216 (R5)

#### 하와
- **클래스**: 치유성 (Cleric)
- **아이템레벨**: 3,020
- **전투력**: 21,890 (E4)

---

### 전투력 분포 분석

| 등급 구간 | 캐릭터 수 | 캐릭터 |
|----------|----------|--------|
| Ruby (35,000+) | 4명 | 대화, 차은욱, 혜지성, 아담 |
| Sapphire (25,000~35,000) | 1명 | 죄수 |
| Emerald (18,000~25,000) | 1명 | 하와 |
| Gold (9,000~13,000) | 1명 | 도룡뇽 |

> **참고**: 전투력은 장비, 칭호, 데바니온 보드 등 모든 스탯을 집계하여 계산됩니다.
