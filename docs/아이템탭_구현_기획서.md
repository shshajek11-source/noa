# 아이템탭 구현 기획서

## 현재 구현 상태

### 구현 완료된 기능

| 기능 | 파일 | 상태 |
|------|------|------|
| 아이템 목록 표시 | `ItemManagementTab.tsx` | ✅ |
| 아이템 추가 (검색/수동입력) | `AddItemModal.tsx` | ✅ |
| 아이템 수량 조절 | `EnhancedItemCard.tsx` | ✅ |
| 아이템 단가 입력 | `EnhancedItemCard.tsx` | ✅ |
| 아이템 삭제 | `EnhancedItemCard.tsx` | ✅ |
| 판매완료 처리 | `EnhancedItemCard.tsx` | ⚠️ 부분 |
| 즐겨찾기 | `FavoriteItemsPanel.tsx` | ✅ |
| 검색 필터 | `ItemManagementTab.tsx` | ✅ |
| 판매상태 필터 (전체/미판매/판매완료) | `ItemManagementTab.tsx` | ✅ |
| 판매 통계 (판매완료/미판매 금액) | `ItemManagementTab.tsx` | ✅ |

### 현재 데이터 구조

```typescript
interface LedgerItem {
  id: string
  ledger_character_id: string
  item_id?: string           // 게임 아이템 ID (검색시)
  item_name: string
  item_category: ItemCategory  // equipment | material | wing | etc
  item_grade: ItemGrade        // common | rare | heroic | legendary | ultimate
  quantity: number
  unit_price?: number         // 개당 가격 (등록시 입력)
  total_price?: number        // 총 가격
  obtained_date: string       // 획득일
  sold_price: number | null   // 판매가 (null = 미판매)
  sold_date?: string          // 판매일
  source_content?: string     // 획득처
}
```

---

## 구현 필요 사항

### 1. 판매 가격 입력 기능 (높은 우선순위)

**현재 문제점:**
- "판매완료 처리" 클릭 시 판매 가격 입력 없이 바로 완료 처리됨
- `sold_price`가 0으로 저장됨

**구현 내용:**
```
[판매완료 처리 버튼 클릭]
    ↓
[판매 가격 입력 모달]
  - 단가 기본값: item.unit_price
  - 수량 표시 (수정 불가)
  - 총 판매가 = 단가 × 수량
  - 수수료 옵션 (거래소 5%)
  - 실제 수령액 = 총 판매가 - 수수료
    ↓
[확인] → sold_price, sold_date 저장
```

**수정 파일:**
- `EnhancedItemCard.tsx` - 판매 모달 추가
- `useLedgerItems.ts` - sellItem 함수 개선

---

### 2. 획득처(Source) 표시 개선 (중간 우선순위)

**현재 문제점:**
- 획득처 정보가 저장되지만 카드에 표시 안됨
- 획득처별 필터 없음

**구현 내용:**
- 카드에 획득처 태그 표시
- 획득처별 필터 추가 (초월/원정/성역/악몽/거래소 등)

**수정 파일:**
- `EnhancedItemCard.tsx` - 획득처 표시 추가
- `ItemManagementTab.tsx` - 획득처 필터 추가

---

### 3. 아이템 정렬 기능 (중간 우선순위)

**현재 문제점:**
- 등록순(최신순)으로만 정렬됨

**구현 내용:**
```
정렬 옵션:
- 최신순 (기본)
- 가격 높은순 / 낮은순
- 등급순 (전설 > 영웅 > 희귀 > 일반)
- 획득일순
```

**수정 파일:**
- `ItemManagementTab.tsx` - 정렬 드롭다운 및 로직

---

### 4. 날짜별 필터 (낮은 우선순위)

**현재 문제점:**
- 모든 아이템이 한 번에 표시됨
- 날짜별 조회 불가

**구현 내용:**
- 기간 선택: 오늘 / 이번 주 / 이번 달 / 전체
- 또는 캘린더에서 선택한 날짜 기준

**수정 파일:**
- `ItemManagementTab.tsx` - 날짜 필터 추가
- `useLedgerItems.ts` - API 파라미터 추가

---

### 5. 통계 개선 (낮은 우선순위)

**현재 상태:**
- 판매완료 금액
- 미판매 개수
- 미판매 총액

**추가 구현:**
```
등급별 통계:
- 전설: 3개 (150만 키나)
- 영웅: 5개 (50만 키나)
- 희귀: 10개 (10만 키나)

획득처별 통계:
- 초월: 5개
- 원정: 3개
- 거래소: 2개
```

**수정 파일:**
- `ItemManagementTab.tsx` - 통계 섹션 확장

---

### 6. 일괄 처리 기능 (낮은 우선순위)

**구현 내용:**
- 체크박스로 여러 아이템 선택
- 일괄 삭제
- 일괄 판매완료 처리

**수정 파일:**
- `EnhancedItemCard.tsx` - 체크박스 추가
- `ItemManagementTab.tsx` - 일괄 처리 버튼

---

### 7. 아이템 이미지 표시 (선택 사항)

**현재 상태:**
- 모든 아이템에 고정 아이콘 💎 표시

**구현 내용:**
- 게임 아이템 검색 시 이미지 URL 저장
- 카드에 실제 아이템 이미지 표시

**수정 파일:**
- DB 스키마: `item_image_url` 컬럼 추가
- `EnhancedItemCard.tsx` - 이미지 표시
- `AddItemModal.tsx` - 이미지 URL 저장

---

## UI/UX 개선 사항

### 카드 레이아웃 개선

**현재:**
```
┌─────────────────────────────┐
│ 💎 아이템명          ☆      │
│    등급 · 카테고리           │
├─────────────────────────────┤
│ 개수 [−] 1 [+]              │
│ 단가  [_______] 키나        │
├─────────────────────────────┤
│ 총액: 100,000 키나          │
├─────────────────────────────┤
│ [판매완료 처리] [삭제]      │
└─────────────────────────────┘
```

**개선안:**
```
┌─────────────────────────────┐
│ [img] 아이템명        ☆     │
│       전설 · 장비 · 초월     │  ← 획득처 추가
├─────────────────────────────┤
│ 수량: 1개                   │
│ 단가: 100,000 키나          │
│ 총액: 100,000 키나          │
├─────────────────────────────┤
│ [💰 판매] [🗑️ 삭제]         │
└─────────────────────────────┘
```

---

## 구현 우선순위

| 순위 | 기능 | 예상 작업량 |
|------|------|-------------|
| 1 | 판매 가격 입력 모달 | 중 |
| 2 | 획득처 표시 | 소 |
| 3 | 정렬 기능 | 소 |
| 4 | 획득처 필터 | 소 |
| 5 | 날짜 필터 | 중 |
| 6 | 통계 개선 | 중 |
| 7 | 일괄 처리 | 중 |
| 8 | 아이템 이미지 | 대 |

---

## 파일 구조

```
frontend/src/app/ledger/
├── components/
│   ├── ItemManagementTab.tsx      # 메인 탭 컨테이너
│   ├── EnhancedItemCard.tsx       # 아이템 카드
│   ├── AddItemModal.tsx           # 아이템 추가 모달
│   ├── SellItemModal.tsx          # [NEW] 판매 모달
│   ├── FavoriteItemsPanel.tsx     # 즐겨찾기 패널
│   └── ItemStatsPanel.tsx         # [NEW] 통계 패널
├── hooks/
│   └── useLedgerItems.ts          # 아이템 데이터 훅
└── page.tsx                       # 메인 페이지

frontend/src/app/api/ledger/
└── items/
    └── route.ts                   # 아이템 CRUD API
```

---

## 다음 단계

1. **판매 가격 입력 기능** 먼저 구현 (핵심 기능)
2. **획득처 표시 + 정렬** 추가
3. 사용성 테스트 후 추가 기능 결정
