# 아이온2 실시간 방송 정보 기능 설계

## 📋 기능 개요

메인페이지에 천족/마족으로 구분된 아이온2 방송 BJ들의 실시간 라이브 정보를 표시하는 섹션을 추가합니다.

### 핵심 요구사항
- ✅ 천족/마족 종족별 구분
- ✅ 실시간 라이브 상태 표시
- ✅ 방송 썸네일 노출
- ✅ 클릭 시 방송 링크로 이동

---

## 🎨 UI 배치 위치 옵션

### **옵션 1: 히어로 섹션 바로 아래 (🌟 추천)**

```
┌─────────────────────────────────────┐
│   히어로 섹션 (검색 박스)              │
└─────────────────────────────────────┘
┌─────────────────────────────────────┐
│   📺 실시간 아이온2 방송               │  ← 여기!
│   [천족] [마족] 탭                     │
│   [썸네일] [썸네일] [썸네일] ...       │
└─────────────────────────────────────┘
┌─────────────────────────────────────┐
│   메뉴 카드 그리드                     │
└─────────────────────────────────────┘
```

**장점:**
- 가장 눈에 잘 띄는 위치
- 유저가 첫 화면에서 바로 확인 가능
- 검색 후 방송 시청으로 자연스러운 동선

**단점:**
- 페이지 초반부가 길어질 수 있음

---

### 옵션 2: 메뉴 카드 그리드와 대시보드 사이

```
┌─────────────────────────────────────┐
│   메뉴 카드 그리드                     │
└─────────────────────────────────────┘
┌─────────────────────────────────────┐
│   📺 실시간 아이온2 방송               │  ← 여기!
└─────────────────────────────────────┘
┌─────────────────────────────────────┐
│   대시보드 그리드 (랭킹/최근업데이트)   │
└─────────────────────────────────────┘
```

**장점:**
- 컨텐츠 간 균형있는 배치
- 스크롤 후 자연스럽게 노출

**단점:**
- 첫 화면에서 바로 보이지 않을 수 있음

---

### 옵션 3: 대시보드 그리드 내부 통합

```
┌────────────────────┬────────────────────┐
│  실시간 랭킹       │  최근 업데이트      │
├────────────────────┴────────────────────┤
│        📺 실시간 방송 (가로 전체)        │  ← 여기!
└──────────────────────────────────────────┘
```

**장점:**
- 공간 효율성
- 관련 정보들과 함께 배치

**단점:**
- 시각적 임팩트가 약할 수 있음
- 썸네일 크기 제약

---

## 🎯 최종 추천: 옵션 1 (히어로 섹션 바로 아래)

### 배치 이유
1. 실시간 방송은 시의성이 중요 → 상단 배치 필수
2. 커뮤니티 활성화 목적 → 눈에 잘 띄어야 함
3. 유저 체류 시간 증가 효과

---

## 🖼️ UI 디자인 상세

### 레이아웃 구조

```jsx
<section className="live-broadcasts-section">
  <div className="section-header">
    <h2>📺 실시간 아이온2 방송</h2>
    <div className="race-tabs">
      <button className="tab active">천족</button>
      <button className="tab">마족</button>
      <button className="tab">전체</button>
    </div>
  </div>

  <div className="broadcasts-grid">
    <BroadcastCard />
    <BroadcastCard />
    <BroadcastCard />
    <BroadcastCard />
  </div>

  <div className="view-more">
    <button>더보기</button>
  </div>
</section>
```

### BroadcastCard 컴포넌트

```
┌─────────────────────────────────┐
│  [LIVE 🔴]      [천족 아이콘]     │ ← 라이브 배지 + 종족 표시
│                                  │
│         방송 썸네일 이미지         │
│        (16:9 비율)                │
│                                  │
├─────────────────────────────────┤
│  BJ 닉네임                        │
│  시청자 수: 1,234명               │
│  방송 제목 (1줄 말줄임)            │
└─────────────────────────────────┘
```

### 스타일 가이드라인

```css
.broadcasts-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.broadcast-card {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.3s, box-shadow 0.3s;
}

.broadcast-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4);
  border-color: var(--primary);
}

.thumbnail-container {
  position: relative;
  aspect-ratio: 16/9;
  background: #000;
}

.live-badge {
  position: absolute;
  top: 0.5rem;
  left: 0.5rem;
  background: #ef4444;
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 4px;
  font-weight: bold;
  font-size: 0.85rem;
}

.race-badge {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  padding: 0.25rem 0.75rem;
  border-radius: 4px;
  font-size: 0.85rem;
}

.race-badge.elyos {
  background: rgba(59, 130, 246, 0.9); /* 천족 파란색 */
  color: white;
}

.race-badge.asmodian {
  background: rgba(239, 68, 68, 0.9); /* 마족 빨간색 */
  color: white;
}
```

---

## 📊 데이터 구조

### API Response 예시

```typescript
interface LiveBroadcast {
  id: string;                    // 방송 고유 ID
  platform: 'twitch' | 'afreeca' | 'youtube'; // 플랫폼
  channelId: string;             // 채널 ID
  channelName: string;           // BJ 닉네임
  title: string;                 // 방송 제목
  thumbnailUrl: string;          // 썸네일 URL
  viewerCount: number;           // 시청자 수
  race: 'elyos' | 'asmodian';    // 종족 (천족/마족)
  isLive: true;                  // 라이브 상태
  streamUrl: string;             // 방송 링크
  startedAt: string;             // 방송 시작 시간 (ISO 8601)
  tags?: string[];               // 태그 (예: "PVP", "레이드", "초보")
}

interface LiveBroadcastsResponse {
  total: number;
  elyosCount: number;
  asmodianCount: number;
  broadcasts: LiveBroadcast[];
}
```

### API Endpoint

```
GET /api/live-broadcasts?race=elyos&limit=8
GET /api/live-broadcasts?race=asmodian&limit=8
GET /api/live-broadcasts?limit=16  // 전체
```

---

## 🔌 API 연동 방안

### 1. 트위치 API 연동

```javascript
// Twitch API v5/Helix 사용
const TWITCH_CLIENT_ID = process.env.TWITCH_CLIENT_ID;
const TWITCH_GAME_ID = '아이온2_게임_ID';

async function fetchTwitchStreams() {
  const response = await fetch(
    `https://api.twitch.tv/helix/streams?game_id=${TWITCH_GAME_ID}`,
    {
      headers: {
        'Client-ID': TWITCH_CLIENT_ID,
        'Authorization': `Bearer ${TWITCH_ACCESS_TOKEN}`
      }
    }
  );

  return response.json();
}
```

### 2. 아프리카TV API 연동

```javascript
// 아프리카TV API 사용
async function fetchAfreecaStreams() {
  const response = await fetch(
    'https://api.afreecatv.com/...',  // 실제 엔드포인트
    {
      headers: {
        // 필요한 인증 헤더
      }
    }
  );

  return response.json();
}
```

### 3. 종족 매핑 방법

**방법 A: 방송 제목/태그 파싱**
```javascript
function detectRace(title: string, tags: string[]): 'elyos' | 'asmodian' | null {
  const titleLower = title.toLowerCase();

  // 천족 키워드
  if (titleLower.includes('천족') ||
      titleLower.includes('elyos') ||
      tags.includes('천족')) {
    return 'elyos';
  }

  // 마족 키워드
  if (titleLower.includes('마족') ||
      titleLower.includes('asmodian') ||
      tags.includes('마족')) {
    return 'asmodian';
  }

  return null;
}
```

**방법 B: 스트리머 DB 관리 (추천)**
```javascript
// 스트리머별 종족 정보를 DB에 저장
// 관리자 페이지에서 수동 매핑 또는 스트리머가 직접 등록

interface StreamerInfo {
  channelId: string;
  race: 'elyos' | 'asmodian';
  verified: boolean;  // 검증된 정보인지
}
```

---

## 🛠️ 구현 계획

### Phase 1: UI 컴포넌트 구현

1. `LiveBroadcastsSection.tsx` 생성
2. `BroadcastCard.tsx` 생성
3. 탭 전환 기능 구현
4. 반응형 그리드 레이아웃

### Phase 2: API 통합

1. Backend: 트위치 API 연동 엔드포인트 구현
2. Backend: 아프리카TV API 연동 (선택)
3. Frontend: API 호출 및 데이터 페칭
4. 캐싱 전략 (5분 단위 갱신)

### Phase 3: 추가 기능

1. 자동 새로고침 (실시간 업데이트)
2. 필터링 (시청자 수, 최신순)
3. 스트리머 즐겨찾기 기능
4. 푸시 알림 (즐겨찾기 스트리머 방송 시작 시)

---

## 📁 파일 구조

```
frontend/src/app/
├── components/
│   ├── LiveBroadcastsSection.tsx    // 메인 섹션
│   ├── BroadcastCard.tsx            // 개별 방송 카드
│   └── RaceTabs.tsx                 // 종족 탭 컴포넌트
└── page.tsx                          // 메인페이지 (수정)

backend/
├── routes/
│   └── live_broadcasts.py           // 라이브 방송 API
├── services/
│   ├── twitch_service.py            // 트위치 연동
│   └── afreeca_service.py           // 아프리카TV 연동
└── models/
    └── streamer.py                  // 스트리머 정보 모델
```

---

## 🎬 사용자 시나리오

### 시나리오 1: 천족 유저
1. 메인페이지 접속
2. "천족" 탭 클릭
3. 현재 방송 중인 천족 스트리머 확인
4. 관심있는 방송 클릭하여 시청

### 시나리오 2: 방송 시작 알림
1. 즐겨찾기한 스트리머가 방송 시작
2. 사이트 방문 시 배지 표시
3. 클릭하여 바로 방송 시청

---

## 🔧 기술 스택

### Frontend
- React (Next.js)
- TypeScript
- CSS Modules / Tailwind

### Backend
- Python (FastAPI)
- PostgreSQL (스트리머 정보 저장)
- Redis (API 응답 캐싱)

### External APIs
- Twitch API (Helix)
- Afreeca TV API
- YouTube Live Streaming API (선택)

---

## 📈 성능 최적화

1. **API 응답 캐싱**: 5분 단위로 캐시 갱신
2. **이미지 최적화**: Next.js Image 컴포넌트 사용
3. **Lazy Loading**: 스크롤 시 카드 로드
4. **Skeleton UI**: 로딩 중 스켈레톤 표시

---

## 🚀 배포 전 체크리스트

- [ ] 트위치 API 키 발급 및 환경변수 설정
- [ ] 아프리카TV API 연동 여부 결정
- [ ] 스트리머 종족 정보 초기 데이터 입력
- [ ] 모바일 반응형 테스트
- [ ] 로딩 상태 및 에러 처리
- [ ] 라이브 방송이 없을 때 UI 처리

---

## 💡 향후 확장 아이디어

1. **클립/하이라이트 섹션**: 인기 클립 모음
2. **스트리머 랭킹**: 시청자 수, 팔로워 기반
3. **VOD 아카이브**: 다시보기 제공
4. **커뮤니티 기능**: 스트리머별 팬 커뮤니티
5. **일정 캘린더**: 정기 방송 스케줄 표시

---

# 검색 자동완성 및 최근 기록 기능 설계

## 📋 기능 개요

아이온2 캐릭터 검색 시, 사용자가 이전에 검색했던 캐릭터 기록을 저장하고 검색창 포커스 시 자동완성 목록(최근 검색어)으로 보여주는 기능입니다. 단순 텍스트가 아닌 **상세 캐릭터 카드** 형태로 정보를 제공합니다.

### 핵심 요구사항
- ✅ **로컬 저장소(LocalStorage) 활용**: 별도 로그인 없이 브라우저 단위로 기록 저장
- ✅ **Update-on-Write**: 동일 캐릭터 검색 시 기존 기록 삭제 후 최신 정보로 갱신 (맨 위로 이동)
- ✅ **상세 정보 표시**:
    - 캐릭터 레벨 (아바타 뱃지)
    - 템레벨 (아이콘 + 수치)
    - 종족, 서버, 직업
- ✅ **직관적인 UI**: 유저가 제공한 레퍼런스 이미지(상세페이지 프로필 스타일) 반영

---

## 💾 데이터 구조 (LocalStorage)

브라우저의 `localStorage`에 `aion_recent_searches` 키로 JSON 배열을 저장합니다.

```typescript
// LocalStorage Key: 'aion_recent_searches'
type RecentSearchHistory = RecentCharacter[];

interface RecentCharacter {
  id: string;          // 고유 식별자 (server_id + '_' + character_name)
  name: string;        // 캐릭터명 (예: 패악질)
  server: string;      // 서버명 (예: 지켈)
  serverId: number;    // 서버 ID (API 요청용)
  race: string;        // 종족 (elyos/asmodian) - UI 색상 구분용
  class: string;       // 직업 (예: 신, 검성...)
  level: number;       // 캐릭터 레벨 (예: 45)
  itemLevel: number;   // 아이템 레벨 (예: 3496)
  profileImage: string;// 프로필 이미지 URL
  timestamp: number;   // 저장 시간 (정렬용)
}
```

---

## 🎨 UI 디자인 상세 (Compact Mode)

아이온2의 많은 서버와 동일 닉네임을 고려하여, **한 화면에 최대한 많은 정보를 담을 수 있도록 슬림하고 컴팩트한 디자인**을 채택합니다.

### 1. 드롭다운 레이아웃
- **Max Height**: `400px` (스크롤 가능)
- **Item Height**: `56px` ~ `64px` (고정 높이)

```jsx
<div className="search-dropdown">
  <div className="recent-history-list">
    <div className="list-header">최근 검색한 캐릭터</div>
    {history.map(char => (
      <RecentCharacterCard key={char.id} character={char} compact={true} />
    ))}
  </div>
</div>
```

### 2. RecentCharacterCard (Compact)

공간 효율성을 극대화한 가로형 레이아웃입니다.

```
┌─────────────────────────────────────────────────────────────┐
│ [Img]  [이름 (Lv.45)]  |  지켈 (신)  |  🛡️ 3,496     [X]  │
└─────────────────────────────────────────────────────────────┘
```

**상세 구성요소:**

*   **1. 아바타 (Left, Fixed Width)**
    *   크기: `40px x 40px` (작은 원형)
    *   **레벨 뱃지**: 아바타 하단에 작게 오버레이 (폰트 10px).

*   **2. 정보 영역 (Flex Row - 가로 배치)**
    *   **이름**: 가장 강조됨 (White, Bold 14px).
    *   **서버/직업**: 옅은 회색 (Gray-400, 13px). `지켈` `|` `검성`
    *   **템레벨**: 우측 정렬 직전 배치. (아이콘 + 노란색 숫자, 13px).

*   **3. 액션 영역 (Right)**
    *   삭제(`X`) 버튼: 마우스 호버 시에만 강조됨.

**스타일 포인트:**
- 카드 **높이를 줄이고(56px 내외)**, 정보들을 **가로로 나열**하여 수직 공간을 절약합니다.
- 불필요한 줄바꿈을 없애 한 눈에 정보를 파악합니다.


---

## 🔄 로직 흐름도 (수정됨)

### 1. 검색바 (Search Input) 동작
- **검색 시**: 단순히 해당 캐릭터 페이지로 이동 (`router.push`)만 수행합니다. **이 시점에는 로컬 스토리지에 저장하지 않습니다.**
- **자동완성 목록**: `localStorage`에 저장된 목록을 불러와 표시만 합니다.

### 2. 캐릭터 상세 페이지 (Detail Page) 동작 (저장 시점)
데이터 저장/갱신은 반드시 **상세 페이지에서 유효한 데이터가 로드되었을 때** 발생합니다.

1.  **페이지 진입 시 (Load)**:
    *   캐릭터 상세 정보 API 호출 성공 시 `saveToHistory(characterData)` 실행.
    *   (즉, 사용자가 캐릭터를 '조회'하여 최신 데이터를 확인했을 때 기록됨)

2.  **새로고침 버튼 클릭 시 (Refresh)**:
    *   강제 갱신 API (`refresh=true`) 호출 성공 시 `saveToHistory(characterData)` 실행.
    *   이때 기존 저장된 정보가 있다면 삭제되고, 갱신된 최신 정보(레벨, 템레벨 등)로 덮어씌워짐.

### 3. saveToHistory 로직
1.  `localStorage` 로드.
2.  동일 ID(서버+이름) 존재 시 삭제.
3.  새 데이터를 맨 앞에 추가 (`unshift`).
4.  최대 10개 유지.
5.  저장.

---

---

## 📁 파일 및 컴포넌트 구조

기존 `Header` 또는 `SearchSection` 컴포넌트 내부를 수정합니다.

```
src/app/components/
├── SearchBar.tsx           // (수정) 검색 로직 및 드롭다운 컨테이너
├── SearchAutocomplete.tsx  // (신규) 자동완성/최근검색어 목록 렌더링
└── RecentCharacterCard.tsx // (신규) 개별 캐릭터 카드 UI
```

---

## 📌 스타일 가이드 (CSS/Tailwind)

*   **템레벨 아이콘**: 투구 모양 SVG 또는 게임 내 아이콘 에셋 사용.
*   **레벨 뱃지**:
    ```css
    .level-badge {
      position: absolute;
      bottom: -5px;
      right: -5px;
      background: rgba(0,0,0,0.8);
      color: white;
      font-weight: 800;
      border: 1px solid #Gold;
      box-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    ```
*   **텍스트 색상**:
    *   정보 구분자(`|`): `#4B5563` (Gray-600)
    *   템레벨: `#F3F4F6` (Gray-100) 강조


