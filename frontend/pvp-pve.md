# 아이온2 전투력(ECP) 계산식 v1.0 (PVE / PVP 분리 적용용)

> 목적: **유저가 납득 가능한 “실효 전투력(ECP)” 지표**를 PVE / PVP로 분리하여 사이트에서 독립 적용  
> 원칙: (1) **공식 패치로 고정되는 값은 고정** (2) 상대 스탯/상한 논쟁 구간은 **옵션·슬라이더(추정치)** 로 분리 (3) “명중 게이트”를 먼저 반영

---

## 0) 공통 입력값(0~1 정규화 권장)

### 내 스탯(필수/권장)
- `weaponAtk` : 무기공격력(표기값)
- `atk` : 공격력(표기값)
- `mainStat` : 주스탯(표기값)
- `crit` : 치명 확률 (0~1)
- `critDmg` : 치명타 피해 증가(추가 배율) (0~1)  
  - 예: “치피증 +20%”라면 `critDmg = 0.20`
- `smash` : 강타 확률 (0~1)
- `multiHit` : 다단 확률 (0~1)
- `perfect` : 완벽 확률 (0~1)
- `speed` : 전투속도/공속 (0~1)  
  - 예: “공속 35%”라면 `speed = 0.35`
- `pvpAtk` : PvP 공격력(표기값, PVP에서만)
- `pvpDef` : PvP 방어력(표기값, PVP에서만)
- `hp` : HP(표기값, PVP에서만)
- `critRes` : 치명저항(표기값, PVP 생존에서만)
- `smashRes` : 강타저항(표기값, PVP 생존에서만)

### 상대/환경(옵션, 기본값 제공)
- `critResAvg` : 상대 평균 치명저항에 따른 “치명률 감소치”(0~1로 환산된 값)
- `smashResAvg` : 상대 평균 강타저항에 따른 “강타 발동률 감소율”(0~1)
- `missRate` : 명중 부족으로 인한 판정 손실률(0~1)

> ⚠️ `critResAvg / smashResAvg / missRate`는 **단정 값이 아니라 “옵션”** 으로 제공하는 것을 강력 권장  
> (서버/티어/상대유형 선택 → 기본값 자동 세팅)

---

## 1) 공통 구성요소 Attachment (PVE/PVP 공용)

### 1-1) 기본 공격력 베이스
```
P_base = (weaponAtk * 12) + (atk * 3) + (mainStat * 1.5)
```

### 1-2) 공속(전투속도) 승수: “50% 이후 수익 체감”
- 하드캡 절단(초과 0점)은 반발이 큼 → **50% 초과분은 일부만 인정**
```
s = clamp(speed, 0, 1)

M_speed = 1 / (1 - min(s, 0.5))  *  (1 + 0.3 * max(0, s - 0.5))
```
- 해석
  - 0~50%: 강하게 반영
  - 50% 초과: 초과분 효율을 30%만 반영(조정 가능)

### 1-3) 명중 게이트(판정 손실 반영)
```
G_hit = clamp(1 - missRate, 0.6, 1.0)
```
- 기본값 추천(유저 입력 없을 때)
  - PVE: `missRate = 0.02`
  - PVP: `missRate = 0.06`

---

## 2) PVE 전투력(ECP_PVE)

### 2-1) Proc 기대값(배율)
- 치명: 기본 1.5배라고 가정 → “추가 +0.5”
- 강타: 기본 2.0배라고 가정 → “추가 +1.0”
- 다단: 문서 기반 기본 상수(기본값 0.089)  
- 완벽(Perfect): 평균 DPS 상승은 과대 단정 금지 → `k_perf`는 보수 시작 권장

```
k_perf = 0.03   # 권장 범위 0.02 ~ 0.04 (모드/옵션으로 제공)

M_proc_PVE =
  1
  + (crit     * (0.5 + critDmg))
  + (smash    * 1.0)
  + (multiHit * 0.089)
  + (perfect  * k_perf)
```

### 2-2) 최종 PVE 점수
```
ECP_PVE = P_base * M_speed * G_hit * M_proc_PVE
```

---

## 3) PVP 전투력(ECP_PVP)

> 패치 반영: PvP 치명 배율 1.25(추가 +0.25), PvP 강타 배율 1.5(추가 +0.5)  
> PvP 기본 보정: 100% → 80% (기본값 0.80), 최소값 40% → 35% (최소 0.35)

### 3-1) PvP 공격 베이스
```
P_atk_PVP = P_base + (pvpAtk * 10)
```

### 3-2) PvP 피해 보정(격차 모름 → 기본 0.80, 옵션 슬라이더 권장)
```
B_pvp = max(0.35, 0.80)
# 격차 큼/작음 옵션을 넣는다면: 0.35 ~ 0.80 범위 슬라이더로 제공
```

### 3-3) 상대 저항 반영(치명/강타 유효 확률)
```
C_eff = max(0, crit - critResAvg)

# 강타저항은 "발동률 감소"로 모델링
S_eff = max(0, smash * (1 - smashResAvg))
```

### 3-4) PVP Proc 기대값(배율)
- 치명: 1.25배 → “추가 +0.25”
- 강타: 1.5배 → “추가 +0.5”
```
M_proc_PVP =
  1
  + (C_eff    * (0.25 + critDmg))
  + (S_eff    * 0.5)
  + (multiHit * 0.089)
```

### 3-5) 생존 점수(딜과 분리 합산)
```
P_surv =
  (hp * 1.0)
  + (pvpDef   * 15.0)
  + (critRes  * 2.0)
  + (smashRes * 2.0)
```
- 가중치(15/2/2)는 **캘리브레이션 대상**  
  - 사이트에 “검증 탭”을 두고 로그/유저 피드백으로 조정

### 3-6) 최종 PVP 점수
```
ECP_PVP =
  (P_atk_PVP * M_speed * G_hit * M_proc_PVP * B_pvp)
  + P_surv
```

---

## 4) 기본값(권장 프리셋)

### 4-1) PVE 기본값
- `missRate = 0.02`
- `k_perf = 0.03`
- `critResAvg = 0`
- `smashResAvg = 0`
- `B_pvp` 사용 안 함

### 4-2) PVP 기본값(상대 평균 추정)
- `missRate = 0.06`
- `critResAvg = 0.10` (예: 치명률 -10% 정도로 시작, 옵션화 권장)
- `smashResAvg = 0.25` (예: 강타 발동률 25% 감소로 시작, 옵션화 권장)
- `B_pvp = 0.80` (격차 옵션 슬라이더: 0.35~0.80)

> ⚠️ 위 기본값은 “기본 동작을 위한 스타터”입니다.  
> 운영 단계에서 **서버/티어별 프리셋**으로 분리하면 신뢰도가 크게 올라갑니다.

---

## 5) 능력치 기여 우선순위(하단 표시용)

### 5-1) PVE 우선순위(딜 중심)
1. **명중(판정 안정)** → `missRate`를 낮추는 요소(체감 최상)
2. **강타 확률(smash)**
3. **치명 확률(crit) + 치피증(critDmg)**
4. **공속(speed) 0~50% 구간**
5. **무기공격력/공격력/주스탯(베이스 스케일)**
6. **다단(multiHit)**
7. **완벽(perfect)** (기본은 보수 반영: 0.02~0.04)

### 5-2) PVP 우선순위(딜 + 생존 혼합)
1. **PvP방어(pvpDef) + HP(hp)** (생존 = 전투 지속 = 실전 승률)
2. **치명저항(critRes) + 강타저항(smashRes)** (폭딜 억제)
3. **명중(판정 안정)** → `missRate` 감소
4. **PvP공격(pvpAtk)**
5. **치명(crit) + 치피증(critDmg)** (배율 1.25 기준)
6. **강타(smash)** (배율 1.5 기준 + 저항 영향 큼)
7. **공속(speed)**
8. **다단(multiHit) / 완벽(perfect)** (PVP에서 영향 불확실, 옵션 권장)

---

## 6) 사이트 적용 메모(권장 UI/운영)
- 상단 토글: **PVE / PVP**
- 옵션(권장):  
  - PVP에서 **상대 평균 치명저항/강타저항 슬라이더**  
  - **명중 부족 체크박스**(missRate 자동 상향)  
  - 공속 50% 이후 효율(0.3) 조절(“고급 옵션”)
- 표기: `ECP v1.0 (패치 기준일: 2026-01-14)` 같은 **버전/기준일**을 항상 노출

---
끝.
