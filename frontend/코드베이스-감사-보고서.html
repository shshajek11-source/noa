<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HITON2 코드베이스 감사 보고서</title>
    <style>
        :root {
            --bg-main: #0B0D12;
            --bg-card: #1a1d24;
            --primary: #FACC15;
            --text-main: #E5E7EB;
            --text-muted: #9CA3AF;
            --success: #22C55E;
            --warning: #F59E0B;
            --error: #EF4444;
            --info: #3B82F6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-main);
            color: var(--text-main);
            line-height: 1.6;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #333;
        }

        h1 {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 1.1rem;
        }

        .date {
            color: var(--text-muted);
            margin-top: 1rem;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .summary-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }

        .summary-card.critical {
            border-left: 4px solid var(--error);
        }

        .summary-card.high {
            border-left: 4px solid var(--warning);
        }

        .summary-card.medium {
            border-left: 4px solid var(--info);
        }

        .summary-card.low {
            border-left: 4px solid var(--success);
        }

        .summary-number {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary);
        }

        .summary-label {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        section {
            margin-bottom: 3rem;
        }

        h2 {
            color: var(--primary);
            font-size: 1.5rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary);
        }

        h3 {
            color: var(--text-main);
            font-size: 1.2rem;
            margin: 1.5rem 0 1rem;
        }

        .issue-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .issue-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .issue-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .priority-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .priority-critical {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }

        .priority-high {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .priority-medium {
            background: rgba(59, 130, 246, 0.2);
            color: var(--info);
        }

        .priority-low {
            background: rgba(34, 197, 94, 0.2);
            color: var(--success);
        }

        .issue-description {
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .issue-location {
            background: #0d1117;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .impact-box {
            background: rgba(250, 204, 21, 0.1);
            border-left: 3px solid var(--primary);
            padding: 1rem;
            border-radius: 0 8px 8px 0;
        }

        .impact-label {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .solution-box {
            background: rgba(34, 197, 94, 0.1);
            border-left: 3px solid var(--success);
            padding: 1rem;
            border-radius: 0 8px 8px 0;
            margin-top: 1rem;
        }

        .solution-label {
            font-weight: 600;
            color: var(--success);
            margin-bottom: 0.5rem;
        }

        .analogy {
            font-style: italic;
            color: var(--text-muted);
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            margin: 1rem 0;
        }

        .category-intro {
            color: var(--text-muted);
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--bg-card);
            border-radius: 8px;
        }

        footer {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid #333;
            color: var(--text-muted);
        }

        .toc {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 3rem;
        }

        .toc h3 {
            margin-top: 0;
            color: var(--primary);
        }

        .toc ul {
            list-style: none;
            padding-left: 0;
        }

        .toc li {
            padding: 0.5rem 0;
        }

        .toc a {
            color: var(--text-main);
            text-decoration: none;
        }

        .toc a:hover {
            color: var(--primary);
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            h1 {
                font-size: 1.8rem;
            }

            .summary-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>HITON2 코드베이스 감사 보고서</h1>
            <p class="subtitle">Vercel React Best Practices 기준 성능 최적화 분석</p>
            <p class="date">작성일: 2026년 1월 19일</p>
        </header>

        <div class="summary-cards">
            <div class="summary-card critical">
                <div class="summary-number">5</div>
                <div class="summary-label">긴급 (Critical)</div>
            </div>
            <div class="summary-card high">
                <div class="summary-number">8</div>
                <div class="summary-label">높음 (High)</div>
            </div>
            <div class="summary-card medium">
                <div class="summary-number">12</div>
                <div class="summary-label">보통 (Medium)</div>
            </div>
            <div class="summary-card low">
                <div class="summary-number">6</div>
                <div class="summary-label">낮음 (Low)</div>
            </div>
        </div>

        <nav class="toc">
            <h3>목차</h3>
            <ul>
                <li><a href="#waterfall">1. 비동기 워터폴 (순차적 데이터 로딩 문제)</a></li>
                <li><a href="#caching">2. 클라이언트 캐싱 부재</a></li>
                <li><a href="#rerender">3. 불필요한 리렌더링</a></li>
                <li><a href="#bundle">4. 번들 크기 최적화</a></li>
                <li><a href="#server">5. 서버/클라이언트 분리</a></li>
                <li><a href="#next-steps">6. 권장 개선 순서</a></li>
            </ul>
        </nav>

        <!-- 비동기 워터폴 -->
        <section id="waterfall">
            <h2>1. 비동기 워터폴 (순차적 데이터 로딩 문제)</h2>

            <div class="category-intro">
                <strong>쉽게 말하면:</strong> 마트에서 장보기 할 때, 채소 코너 다 보고 → 정육 코너 가고 → 유제품 코너 가는 것처럼
                순서대로 가면 시간이 오래 걸립니다. 하지만 가족이 3명이면 각자 다른 코너에서 동시에 장을 볼 수 있죠.
                <br><br>
                현재 코드에서는 <strong>동시에 가져올 수 있는 데이터를 순서대로 기다리고 있어</strong> 페이지 로딩이 느립니다.
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <span class="issue-title">로그인 정보 + 대표캐릭터 순차 로딩</span>
                    <span class="priority-badge priority-critical">긴급</span>
                </div>
                <div class="issue-description">
                    사용자 로그인 후 닉네임과 대표 캐릭터 정보를 <strong>순서대로</strong> 가져오고 있습니다.
                    두 정보는 서로 의존하지 않아 동시에 가져올 수 있습니다.
                </div>
                <div class="issue-location">
                    파일: AuthContext.tsx (123-125번 줄)
                </div>
                <div class="impact-box">
                    <div class="impact-label">영향</div>
                    로그인 후 화면 표시까지 200~400ms 추가 지연
                </div>
                <div class="solution-box">
                    <div class="solution-label">해결 방법</div>
                    Promise.all()을 사용해 두 API를 동시에 호출
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <span class="issue-title">파티 검색: 로컬 → 라이브 순차 검색</span>
                    <span class="priority-badge priority-critical">긴급</span>
                </div>
                <div class="issue-description">
                    파티 스캐너에서 캐릭터를 검색할 때 <strong>내부 DB 검색이 끝난 후에야</strong>
                    외부 API 검색을 시작합니다. 두 검색은 동시에 진행 가능합니다.
                </div>
                <div class="issue-location">
                    파일: usePartyScanner.ts (1020-1035번 줄)
                </div>
                <div class="impact-box">
                    <div class="impact-label">영향</div>
                    검색 결과 표시까지 500ms 이상 추가 지연
                </div>
                <div class="solution-box">
                    <div class="solution-label">해결 방법</div>
                    로컬 검색과 라이브 검색을 Promise.all()로 병렬 실행 후 결과 병합
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <span class="issue-title">캐릭터 상세: OCR 스탯 순차 로딩</span>
                    <span class="priority-badge priority-high">높음</span>
                </div>
                <div class="issue-description">
                    캐릭터 상세 페이지에서 기본 정보를 모두 가져온 <strong>다음에야</strong>
                    OCR 스탯을 가져옵니다. 기본 정보와 OCR 스탯은 동시에 요청할 수 있습니다.
                </div>
                <div class="issue-location">
                    파일: app/c/[server]/[name]/page.tsx (640-667번 줄)
                </div>
                <div class="impact-box">
                    <div class="impact-label">영향</div>
                    캐릭터 페이지 로딩 300~500ms 추가 지연
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <span class="issue-title">가계부: 캐릭터 상태 + 아이템 순차 로딩</span>
                    <span class="priority-badge priority-high">높음</span>
                </div>
                <div class="issue-description">
                    가계부 페이지에서 캐릭터 상태와 아이템 목록을 순서대로 가져옵니다.
                </div>
                <div class="issue-location">
                    파일: useLedgerItems.ts, character-state API
                </div>
                <div class="impact-box">
                    <div class="impact-label">영향</div>
                    가계부 페이지 초기 로딩 지연
                </div>
            </div>
        </section>

        <!-- 클라이언트 캐싱 -->
        <section id="caching">
            <h2>2. 클라이언트 캐싱 부재</h2>

            <div class="category-intro">
                <strong>쉽게 말하면:</strong> 같은 음식점 전화번호를 찾을 때마다 114에 전화하는 것과 같습니다.
                한 번 찾은 번호를 메모장에 적어두면 다음부터는 바로 전화할 수 있죠.
                <br><br>
                현재 <strong>이미 가져온 데이터를 저장해두지 않고 매번 새로 요청</strong>합니다.
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <span class="issue-title">캐릭터 상세 페이지 - 캐싱 없음</span>
                    <span class="priority-badge priority-critical">긴급</span>
                </div>
                <div class="issue-description">
                    캐릭터 상세 페이지에서 4개 이상의 API를 호출하는데,
                    <strong>페이지를 다시 방문할 때마다 모든 데이터를 처음부터</strong> 다시 가져옵니다.
                    캐릭터 정보는 자주 바뀌지 않으므로 일정 시간 저장해두면 즉시 표시할 수 있습니다.
                </div>
                <div class="issue-location">
                    파일: app/c/[server]/[name]/page.tsx
                </div>
                <div class="impact-box">
                    <div class="impact-label">영향</div>
                    같은 캐릭터 페이지 재방문 시 불필요한 로딩 대기 (1-2초)
                </div>
                <div class="solution-box">
                    <div class="solution-label">해결 방법</div>
                    SWR 또는 React Query 라이브러리 도입하여 자동 캐싱 적용
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <span class="issue-title">가계부 - 탭 전환 시 재로딩</span>
                    <span class="priority-badge priority-high">높음</span>
                </div>
                <div class="issue-description">
                    가계부에서 탭을 전환할 때마다 캐릭터 상태를 다시 불러옵니다.
                    이미 가져온 데이터인데도 매번 서버에 요청합니다.
                </div>
                <div class="issue-location">
                    파일: app/ledger/page.tsx
                </div>
                <div class="impact-box">
                    <div class="impact-label">영향</div>
                    탭 전환 시 깜빡임 및 로딩 지연
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <span class="issue-title">검색 자동완성 - 중복 요청</span>
                    <span class="priority-badge priority-medium">보통</span>
                </div>
                <div class="issue-description">
                    검색창에서 같은 검색어를 다시 입력해도 매번 API를 호출합니다.
                    최근 검색 결과를 캐싱하면 즉시 표시할 수 있습니다.
                </div>
                <div class="issue-location">
                    파일: SearchAutocomplete.tsx
                </div>
            </div>
        </section>

        <!-- 리렌더링 -->
        <section id="rerender">
            <h2>3. 불필요한 리렌더링</h2>

            <div class="category-intro">
                <strong>쉽게 말하면:</strong> 집 전체를 청소할 때, 거실 소파 쿠션 하나 바꿨다고
                집 전체를 처음부터 다시 청소하는 것과 같습니다.
                <br><br>
                React에서 <strong>데이터가 조금만 바뀌어도 화면 전체를 다시 그리는</strong> 경우가 많습니다.
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <span class="issue-title">스탯 계산 - 매번 재계산</span>
                    <span class="priority-badge priority-high">높음</span>
                </div>
                <div class="issue-description">
                    스탯 상세 아코디언(StatsDetailAccordion)에서 스탯 합계를 계산할 때
                    <strong>화면이 업데이트될 때마다 모든 계산을 처음부터</strong> 다시 합니다.
                    스탯 데이터가 바뀌지 않았으면 이전 결과를 재사용해야 합니다.
                </div>
                <div class="issue-location">
                    파일: StatsDetailAccordion.tsx (여러 .reduce() 호출)
                </div>
                <div class="impact-box">
                    <div class="impact-label">영향</div>
                    탭 전환, 스크롤 등 사소한 동작에도 계산 반복 → 버벅거림
                </div>
                <div class="solution-box">
                    <div class="solution-label">해결 방법</div>
                    useMemo 훅을 사용해 계산 결과를 기억해두기
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <span class="issue-title">장비 목록 정렬 - 매번 재정렬</span>
                    <span class="priority-badge priority-medium">보통</span>
                </div>
                <div class="issue-description">
                    장비 그리드(EquipmentGrid)에서 장비 목록을 정렬할 때
                    화면이 업데이트될 때마다 똑같은 정렬을 반복합니다.
                </div>
                <div class="issue-location">
                    파일: EquipmentGrid.tsx (97-114번 줄)
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <span class="issue-title">검색 핸들러 - 매번 새로 생성</span>
                    <span class="priority-badge priority-medium">보통</span>
                </div>
                <div class="issue-description">
                    검색 컴포넌트에서 검색 버튼 클릭 핸들러 함수가
                    화면이 그려질 때마다 새로 만들어집니다.
                    이로 인해 하위 컴포넌트도 불필요하게 다시 그려집니다.
                </div>
                <div class="issue-location">
                    파일: SearchBar.tsx, SearchAutocomplete.tsx
                </div>
                <div class="solution-box">
                    <div class="solution-label">해결 방법</div>
                    useCallback 훅을 사용해 함수 재생성 방지
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <span class="issue-title">랭킹 테이블 행 - 전체 리렌더</span>
                    <span class="priority-badge priority-medium">보통</span>
                </div>
                <div class="issue-description">
                    랭킹 테이블에서 한 행만 선택해도 <strong>모든 행이 다시 그려집니다</strong>.
                    각 행을 독립적으로 만들면 선택한 행만 업데이트됩니다.
                </div>
                <div class="issue-location">
                    파일: RankingTable.tsx
                </div>
                <div class="solution-box">
                    <div class="solution-label">해결 방법</div>
                    React.memo를 사용해 각 행 컴포넌트를 최적화
                </div>
            </div>
        </section>

        <!-- 번들 최적화 -->
        <section id="bundle">
            <h2>4. 번들 크기 최적화</h2>

            <div class="category-intro">
                <strong>쉽게 말하면:</strong> 커피 한 잔 마시러 카페에 갔는데,
                전체 메뉴판의 모든 레시피를 다 읽어야 커피가 나오는 것과 같습니다.
                <br><br>
                사용자가 특정 페이지에 접속했을 때, <strong>그 페이지에 필요한 코드만 불러오면</strong> 더 빨리 시작됩니다.
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <span class="issue-title">모달 컴포넌트 - 항상 로딩됨</span>
                    <span class="priority-badge priority-medium">보통</span>
                </div>
                <div class="issue-description">
                    캐릭터 추가 모달, 캘린더 모달 등 <strong>클릭해야만 보이는 화면</strong>이
                    페이지 처음 로드할 때 이미 함께 불러와집니다.
                    필요할 때만 불러오면 초기 로딩이 빨라집니다.
                </div>
                <div class="issue-location">
                    파일: AddCharacterModal.tsx, CalendarModal.tsx 등
                </div>
                <div class="impact-box">
                    <div class="impact-label">영향</div>
                    초기 JavaScript 파일 크기 증가 → 첫 화면 표시 지연
                </div>
                <div class="solution-box">
                    <div class="solution-label">해결 방법</div>
                    next/dynamic을 사용해 필요할 때 불러오기 (지연 로딩)
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <span class="issue-title">스탯 레이더 차트 - 항상 로딩됨</span>
                    <span class="priority-badge priority-low">낮음</span>
                </div>
                <div class="issue-description">
                    레이더 차트는 특정 탭에서만 보이지만,
                    차트 라이브러리가 페이지 진입 시 바로 로드됩니다.
                </div>
                <div class="issue-location">
                    파일: StatsRadarChart.tsx
                </div>
            </div>
        </section>

        <!-- 서버/클라이언트 분리 -->
        <section id="server">
            <h2>5. 서버/클라이언트 분리</h2>

            <div class="category-intro">
                <strong>쉽게 말하면:</strong> 식당에서 음식 주문 시,
                웨이터가 주문을 받아 주방에 전달하고 음식을 가져오는 것이 <strong>서버 처리</strong>입니다.
                손님이 직접 주방에 가서 재료를 가져와 자기 테이블에서 요리하는 것이 <strong>클라이언트 처리</strong>입니다.
                <br><br>
                현재 일부 페이지가 <strong>클라이언트에서 모든 걸 처리</strong>해서 느립니다.
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <span class="issue-title">캐릭터 상세 페이지 - 전체 클라이언트 렌더링</span>
                    <span class="priority-badge priority-critical">긴급</span>
                </div>
                <div class="issue-description">
                    캐릭터 상세 페이지(/c/[server]/[name])가 <strong>전체가 클라이언트 컴포넌트</strong>입니다.
                    서버에서 미리 데이터를 가져와서 HTML을 만들면:
                    <ul style="margin-top: 0.5rem; padding-left: 1.5rem;">
                        <li>검색 엔진(구글)에 페이지 내용이 노출됨 (SEO)</li>
                        <li>사용자가 더 빨리 내용을 볼 수 있음</li>
                        <li>로딩 스피너 대신 바로 콘텐츠 표시</li>
                    </ul>
                </div>
                <div class="issue-location">
                    파일: app/c/[server]/[name]/page.tsx
                </div>
                <div class="impact-box">
                    <div class="impact-label">영향</div>
                    검색 엔진 노출 불가, 초기 로딩 시 빈 화면 표시
                </div>
                <div class="solution-box">
                    <div class="solution-label">해결 방법</div>
                    서버 컴포넌트로 전환하여 초기 데이터를 서버에서 가져오기
                </div>
            </div>

            <div class="issue-card">
                <div class="issue-header">
                    <span class="issue-title">홈페이지 - 클라이언트 데이터 동기화</span>
                    <span class="priority-badge priority-high">높음</span>
                </div>
                <div class="issue-description">
                    홈페이지에서 백그라운드 데이터 동기화가 클라이언트에서 실행됩니다.
                    서버에서 처리하면 사용자 기기 부담이 줄어듭니다.
                </div>
                <div class="issue-location">
                    파일: app/page.tsx
                </div>
            </div>
        </section>

        <!-- 권장 개선 순서 -->
        <section id="next-steps">
            <h2>6. 권장 개선 순서</h2>

            <div class="category-intro">
                모든 문제를 한 번에 해결하기는 어렵습니다.
                <strong>영향도가 크고 구현이 비교적 쉬운 순서</strong>로 개선하는 것을 권장합니다.
            </div>

            <div class="issue-card">
                <h3 style="color: var(--error);">1단계: 즉시 개선 (1-2일)</h3>
                <ul style="padding-left: 1.5rem; margin-top: 1rem;">
                    <li><strong>비동기 워터폴 해결</strong> - Promise.all() 적용
                        <br><small style="color: var(--text-muted);">AuthContext.tsx, usePartyScanner.ts, page.tsx</small></li>
                    <li style="margin-top: 0.75rem;"><strong>useMemo 적용</strong> - 계산 결과 캐싱
                        <br><small style="color: var(--text-muted);">StatsDetailAccordion.tsx, EquipmentGrid.tsx</small></li>
                </ul>
                <div class="impact-box" style="margin-top: 1rem;">
                    <div class="impact-label">예상 효과</div>
                    페이지 로딩 속도 30-50% 개선
                </div>
            </div>

            <div class="issue-card">
                <h3 style="color: var(--warning);">2단계: 단기 개선 (1주)</h3>
                <ul style="padding-left: 1.5rem; margin-top: 1rem;">
                    <li><strong>SWR 또는 React Query 도입</strong> - 데이터 자동 캐싱
                        <br><small style="color: var(--text-muted);">캐릭터 상세 페이지, 가계부 페이지</small></li>
                    <li style="margin-top: 0.75rem;"><strong>모달 지연 로딩</strong> - 초기 번들 크기 감소
                        <br><small style="color: var(--text-muted);">모든 모달 컴포넌트</small></li>
                </ul>
                <div class="impact-box" style="margin-top: 1rem;">
                    <div class="impact-label">예상 효과</div>
                    재방문 시 즉시 표시, 초기 로딩 속도 20% 개선
                </div>
            </div>

            <div class="issue-card">
                <h3 style="color: var(--info);">3단계: 중기 개선 (2-3주)</h3>
                <ul style="padding-left: 1.5rem; margin-top: 1rem;">
                    <li><strong>캐릭터 상세 페이지 서버 컴포넌트 전환</strong>
                        <br><small style="color: var(--text-muted);">SEO 개선 및 초기 로딩 최적화</small></li>
                    <li style="margin-top: 0.75rem;"><strong>React.memo 적용</strong> - 리스트 최적화
                        <br><small style="color: var(--text-muted);">RankingTable.tsx, 기타 목록 컴포넌트</small></li>
                </ul>
                <div class="impact-box" style="margin-top: 1rem;">
                    <div class="impact-label">예상 효과</div>
                    검색 엔진 노출 가능, 전반적인 반응성 개선
                </div>
            </div>
        </section>

        <footer>
            <p>이 보고서는 Vercel React Best Practices 가이드라인을 기준으로 작성되었습니다.</p>
            <p style="margin-top: 0.5rem; color: var(--primary);">HITON2 프로젝트 - 2026년 1월</p>
        </footer>
    </div>
</body>
</html>